# ? Updated Handlebars Structure - Hierarchical Partials

## ?? **NEW Structure (What You Now Have):**

```
???????????????????????????????????????????????????????????????????
? views/illusions.handlebars (Main Template)                      ?
???????????????????????????????????????????????????????????????????
?                                                                  ?
? <div class="container">                                         ?
?   <h1>Deceiver's Blade Illusion Spells</h1>                    ?
?                                                                  ?
?   {{#each categories}} ? Loop through categories                ?
?     {{> category_block}} ? USE PARTIAL                          ?
?   {{/each}}                                                     ?
? </div>                                                          ?
?                                                                  ?
???????????????????????????????????????????????????????????????????
                              ?
???????????????????????????????????????????????????????????????????
? views/partials/category_block.hbs                              ?
???????????????????????????????????????????????????????????????????
?                                                                  ?
? <section class="spell-list-category">                           ?
?   <details>                                                     ?
?     <summary>{{this.categoryName}}</summary>                    ?
?                                                                  ?
?     {{#each this.spells}} ? Loop through spells                ?
?       {{> spell_entry this}} ? USE PARTIAL                      ?
?     {{/each}}                                                   ?
?   </details>                                                    ?
? </section>                                                      ?
?                                                                  ?
???????????????????????????????????????????????????????????????????
                              ?
???????????????????????????????????????????????????????????????????
? views/partials/spell_entry.hbs                                 ?
???????????????????????????????????????????????????????????????????
?                                                                  ?
? <div class="spell-entry">                                       ?
?   <a href="{{this.archiveURL}}">                                ?
?     {{this.spellName}}                                          ?
?   </a>                                                          ?
?                                                                  ?
?   <span class="inline-traits">({{this.traits}})</span>          ?
?                                                                  ?
?   <span class="inline-green-tag">                               ?
?     Rank {{this.rank}}                                          ?
?     {{#if this.spellRange}}, Range: {{this.spellRange}}{{/if}} ?
?     {{#if this.spellTarget}}, Target: {{this.spellTarget}}{{/if}}?
?     {{#if this.area}}, Area: {{this.area}}{{/if}}              ?
?     {{#if this.duration}}, Duration: {{this.duration}}{{/if}}  ?
?     {{#if this.defense}}, Defense: {{this.defense}}{{/if}}     ?
?   </span>                                                       ?
?                                                                  ?
?   {{#if this.heighten}}                                         ?
?     <span class="inline-cyan-tag">                              ?
?       Heighten: {{this.heighten}}                               ?
?     </span>                                                     ?
?   {{/if}}                                                       ?
? </div>                                                          ?
?                                                                  ?
???????????????????????????????????????????????????????????????????
```

---

## ?? **Data Flow Visualization:**

```
Database View: view_spell_details_by_category
?? categoryId: 1
?? categoryName: "Subtle Spells"
?? categoryDescription: "..."
?? spellName: "Burglar's Blind"
?? rank: 3
?? spellRange: "60 feet" ?
?? spellTarget: "1 willing creature" ?
?? area: null ?
?? duration: "sustained up to 10 minutes" ?
?? defense: "" ?
?? heighten: "" ?

                    ?

illusionCallbacks.js transforms into:
context.categories = [
  {
    categoryId: 1,
    categoryName: "Subtle Spells",
    spells: [
      {
        spellName: "Burglar's Blind",
        rank: 3,
        spellRange: "60 feet", ? NOW DISPLAYED! ?
        spellTarget: "1 willing creature", ? NOW DISPLAYED! ?
        duration: "sustained up to 10 minutes", ? NOW DISPLAYED! ?
        ...
      }
    ]
  }
]

                    ?

illusions.handlebars:
{{#each categories}} ? Loop: category 1, 2, 3...
  {{> category_block}} ? Renders category_block.hbs
{{/each}}

                    ?

category_block.hbs:
<summary>Subtle Spells</summary>
{{#each this.spells}} ? Loop: spell 1, 2, 3...
  {{> spell_entry}} ? Renders spell_entry.hbs
{{/each}}

                    ?

spell_entry.hbs:
<div class="spell-entry">
  <a>Burglar's Blind</a>
  <span>Rank 3, Range: 60 feet, Target: 1 willing creature, Duration: sustained up to 10 minutes</span>
</div>

                    ?

FINAL OUTPUT:
??????????????????????????????????????????????????????????
? Deceiver's Blade Illusion Spells                      ?
??????????????????????????????????????????????????????????
?                                                        ?
? ? Subtle Spells [10]                                  ?
?   ? Burglar's Blind (Illusion, Manipulate...)         ?
?      Rank 3, Range: 60 feet, Target: 1 willing       ?
?      creature, Duration: sustained up to 10 minutes    ?
?                                                        ?
?   ? Aura of the Unremarkable (Illusion, Mental...)    ?
?      Rank 6, Range: , Target: , Duration: sustained   ?
?      up to 1 minute                                    ?
?                                                        ?
??????????????????????????????????????????????????????????
```

---

## ?? **Before vs After:**

### **BEFORE (Inline Rendering):**
```handlebars
illusions.handlebars:
  {{#each categories}}
    <div class="spell-list-category">
      <details>
        <summary>{{this.categoryName}}</summary>
        {{#each this.spells}}
          <!-- ALL INLINE - HARD TO MAINTAIN -->
          <div class="spell-entry">
            <a>{{this.spellName}}</a>
            <span>Rank {{this.rank}}</span>
            <!-- ? Missing: range, target, duration, etc. -->
          </div>
        {{/each}}
      </details>
    </div>
  {{/each}}
```

**Problems:**
- ? Code duplication
- ? Hard to maintain
- ? Missing fields not displayed
- ? No reusability

---

### **AFTER (Hierarchical Partials):**
```handlebars
illusions.handlebars:
  {{#each categories}}
    {{> category_block}} ?
  {{/each}}

category_block.hbs:
  <details>
    <summary>{{this.categoryName}}</summary>
    {{#each this.spells}}
      {{> spell_entry}} ?
    {{/each}}
  </details>

spell_entry.hbs:
  <div class="spell-entry">
    <a>{{this.spellName}}</a>
    <span>Rank {{this.rank}}, Range: {{this.spellRange}}...</span> ?
  </div>
```

**Benefits:**
- ? Clean separation of concerns
- ? Easy to maintain
- ? All fields displayed
- ? Reusable components
- ? DRY (Don't Repeat Yourself)

---

## ?? **What Changed:**

| File | Change | Result |
|------|--------|--------|
| `illusions.handlebars` | Uses `{{> category_block}}` | Clean main template |
| `category_block.hbs` | Uses `{{> spell_entry}}` | Renders each spell via partial |
| `spell_entry.hbs` | Removed "blabla", added all fields | Shows range, target, duration, defense, heighten |

---

## ? **Test Results:**

Now when you visit http://localhost:3000/illusion, you should see:

```
Burglar's Blind (Illusion, Manipulate, Rare, Subtle)
Rank 3, Range: 60 feet, Target: 1 willing creature, Duration: sustained up to 10 minutes

Aura of the Unremarkable (Illusion, Mental, Uncommon)
Rank 6, Range: , Area: 30-foot emanation, Duration: sustained up to 1 minute

Invisibility (Illusion, Manipulate, Subtle)
Rank 2, Range: , Target: 1 creature, Duration: 10 minutes
```

All the fields from `view_spell_details_by_category` are now displayed! ??

---

## ?? **To Test:**

1. Refresh http://localhost:3000/illusion
2. Expand any category
3. You should now see ALL spell details: rank, range, target, area, duration, defense, heighten

**The "blabla" was just a test marker - it's been removed!**
